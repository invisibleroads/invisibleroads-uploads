$('.btn-file input').fileupload({
	dataType: 'json',
	progressall: function(e, d) {
		var $o = $(this).parent('span');
		$o.next('.feedback').text(parseInt(d.loaded / d.total * 100) + '%');
	},
	done: function(e, d) {
    var $o = $(this).parent('span'), x = d.result;
		$o.next('.feedback').text('');
    $o.data('upload_id', x.upload_id)
      .trigger('uploaded.ir', x);
	}
});

// Prevent multiple clicks
$('.btn-file').click(function() {
  var $o = $(this), $body = $(document.body);
  $o.prop('disabled', true);
  // Detect dialog close
  $body.on('focus', function() {
    $o.prop('disabled', false);
    $body.off('focus');
  });
});

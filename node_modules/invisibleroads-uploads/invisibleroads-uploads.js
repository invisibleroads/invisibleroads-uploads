$('.btn-file input').fileupload({
	dataType: 'json',
	progressall: function(e, d) {
		var progress = parseInt(d.loaded / d.total * 100, 10);
		var $o = $(this).parent('span');
		$o.next('.progress').css('width', progress + '%');
	},
	done: function(e, d) {
    var $o = $(this).parent('span'), x = d.result;
    $o.data('upload_id', x.upload_id)
      .trigger('uploaded.ir.upload', x);
		$o.next('.progress').css('width', '0%');
	}
}).click(function() {
  // Double-clicking should only open a single dialog
  var $o = $(this).parent('span');
  if ($o.prop('disabled')) return false;
  $o.prop('disabled', true).addClass('disabled');
  setTimeout(function() {
    enable_upload_button($o);
  }, 3000);
});

function enable_upload_button($o) {
  $o.removeAttr('disabled').removeClass('disabled');
}

$('.btn-file input').fileupload({
	dataType: 'json',
	progressall: function(e, d) {
		var $o = $(this).parent('span');
		$o.next('.feedback').text(parseInt(d.loaded / d.total * 100, 10) + '%');
	},
	done: function(e, d) {
    var $o = $(this).parent('span'), x = d.result;
    $o.data('upload_id', x.upload_id)
      .trigger('uploaded.ir.upload', x);
		$o.next('.feedback').text('');
	}
}).click(function() {
  // Double-clicking should only open a single dialog
  var $o = $(this).parent('span');
  if ($o.prop('disabled')) return false;
  $o.prop('disabled', true).addClass('disabled');
  setTimeout(function() {
    $o.removeAttr('disabled').removeClass('disabled');
  }, 3000);
});
